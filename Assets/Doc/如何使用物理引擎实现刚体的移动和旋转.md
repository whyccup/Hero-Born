# 如何使用物理引擎实现3D刚体的移动和旋转

```C#
// 在每个物理更新步骤时运行
 private void FixedUpdate()
 {
  // 创建一个表示旋转的向量，方向为上，大小为水平输入
  Vector3 rotation = Vector3.up * hInput;

  // 将旋转向量转换为四元数，乘以物理更新的时间步长
  Quaternion angleRot = Quaternion.Euler(rotation * Time.fixedDeltaTime);

  // 使用刚体的MovePosition方法移动物体，新的位置为当前位置加上输入的移动量乘以时间步长
  _rb.MovePosition(this.transform.position + Time.fixedDeltaTime * vInput * this.transform.forward);

  // 使用刚体的MoveRotation方法旋转物体，新的旋转为当前旋转乘以旋转的四元数
  _rb.MoveRotation(_rb.rotation * angleRot);
}
```

## 详解

1. `FixedUpdate`：这是Unity中的一个内置函数，它在每个物理更新步骤中运行。物理更新步骤与帧更新步骤（Update）有所不同，前者的时间间隔是固定的，后者则根据计算机的性能和屏幕刷新率可能有所不同。在处理物理相关的行为，如移动和旋转刚体（Rigidbody）时，我们通常在`FixedUpdate`中进行。

2. `Vector3 rotation = Vector3.up * hInput;`：这行代码创建了一个表示旋转的向量。向量的方向是“向上”（对应Unity坐标系中的y轴），大小等于用户的水平输入（可能是用键盘的左右键或者鼠标的左右移动来控制的）。

3. `Quaternion angleRot = Quaternion.Euler(rotation * Time.fixedDeltaTime);`：这行代码将旋转向量转换为四元数。四元数是一种可以用来表示和计算3D旋转的数学结构。`Euler`方法是将欧拉角（表示旋转的三个角度）转换为四元数，而`Time.fixedDeltaTime`是物理更新步骤的时间间隔。

4. `_rb.MovePosition(this.transform.position + Time.fixedDeltaTime * vInput * this.transform.forward);`：这行代码是用来移动物体的。`MovePosition`是Rigidbody的一个方法，用于设置刚体的位置。这里的新位置是当前位置加上用户的垂直输入（可能是用键盘的上下键或者鼠标的上下移动来控制的）乘以时间间隔和物体前方的方向（`this.transform.forward`）。

5. `_rb.MoveRotation(_rb.rotation * angleRot);`：这行代码是用来旋转物体的。`MoveRotation`是Rigidbody的一个方法，用于设置刚体的旋转。这里的新旋转是当前旋转乘以前面计算出来的旋转四元数。

## 名词释义

### 欧拉角（Euler Angles）

欧拉角是一种描述物体在三维空间中旋转的方式，它使用三个角度来表示旋转，通常被称为俯仰角（Pitch），偏航角（Yaw）和翻滚角（Roll）。这三个角度分别代表围绕X轴、Y轴和Z轴的旋转。

虽然欧拉角在一些场景中简单直观，但它有一个被称为“万向锁”（Gimbal Lock）的问题。当两个旋转轴线重合时，就会丧失一个自由度，这就是万向锁现象。举个例子，当飞机的头部直指向上时，它就无法再区分偏航和翻滚了。

### 四元数（Quaternion）

四元数是一个包含四个部分的复数系统，用于在三维空间中表示旋转，能有效避免欧拉角的“万向锁”问题。四元数由一个实数和三个虚数（也可以看作是一个标量和一个向量）组成，形式如 q = w + xi + yj + zk，其中w是实数部分，x、y、z是虚数部分，i、j、k是虚数单位，满足 i² = j² = k² = ijk = -1。。

因为四元数有四个分量，所以无法像复数那样在二维平面上直观地表示。然而，你可以将四元数中的实部视为一种“比例”或者“缩放”因子，而将其他三个虚部看作是一个三维向量，这样一来，四元数就可以在三维空间中表示了。但是请注意，这种可视化方法并不能完全表达四元数的所有性质。

在Unity中，你不需要理解四元数的全部复杂数学理论。只需要知道，如果你想在三维空间中表示和计算旋转，那么使用四元数是一个很好的选择。Unity提供了一系列的四元数函数，可以用于创建、操作和转换四元数。比如，Quaternion.Euler函数可以将欧拉角转换为四元数，Quaternion.RotateTowards函数可以在一定角度内将一个四元数旋转到另一个四元数等。

### 实数（Real Numbers）

实数包括所有可以在数轴上表示的数，它们包括所有的有理数和无理数。有理数是可以表示为两个整数的比的数，比如1/2、2、-5等。无理数不能表示为两个整数的比，比如π和√2等。实数在我们的日常生活和大部分科学研究中占据着主导地位，它们包括整数，小数，正数，负数等等。

### 虚数（Imaginary Numbers）

虚数是形式上可以写作实数与“虚数单位”i的乘积的数，其中虚数单位i是-1的平方根，即i² = -1。例如，2i和-3i都是虚数。虚数的引入是为了解决在实数范围内无法解决的问题，比如求解某些无实数解的方程。

虚数和实数可以组合形成复数。复数由一个实部和一个虚部组成，形式为a + bi，其中a和b都是实数。

### 复数

复数是一种扩展了实数的数的集合。一个复数是由一个实数部分和一个虚数部分组成的数，一般形式为 a + bi，其中 a 和 b 是实数，i 是虚数单位，满足 i² = -1。

在这个表示法中：

a 是复数的实部。
b 是复数的虚部。
例如，5 + 3i 是一个复数，其中 5 是实部，3 是虚部。

复数的主要特点是能够解决实数范围内无法解决的问题，例如求负数的平方根。它们在物理、电子工程、信号处理、量子力学等许多科学领域中都有广泛的应用。

复数还可以在复平面（也称为阿贝尔平面）上进行图形表示。在这个平面上，水平轴表示实部，垂直轴表示虚部。所以，复数 5 + 3i 将被表示为从原点（0,0）到点 (5,3) 的向量。

另外，复数也可以用极坐标表示，形式为 r(cosθ + isinθ)，其中 r 是复数的模（也就是到原点的距离），θ 是复数与正实轴的夹角，这种表示法被称为复数的极形式或者幅角形式。这种形式在处理复数的乘法和除法运算时特别有用，因为模的运算和角度的运算可以分开进行。

与复数相关的运算包括加法、减法、乘法、除法、共轭等，这些运算在处理涉及复数的科学和工程问题时经常会用到。
